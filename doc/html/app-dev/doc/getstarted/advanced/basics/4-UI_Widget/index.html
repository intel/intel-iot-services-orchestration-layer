<h2 id="introduction-of-widget">Introduction of Widget</h2><p>The <strong>Widget</strong> is the basic element that consists the UI of end users, its code base is shared by both <em>ui-dev</em> and <em>ui-user</em> projects.</p><p>Every UI divides the screen as a grid with N rows and 12 columns, the width of each column is about 8.333% width of the browser, and the height of row is fixed to 60px (configurable). The number of rows (N) is dependent on the height of the browser.</p><p>Each initial instance of widgets occupies 1x1 size on the grid, developers can resize it by drag and drop.</p><h2 id="widget-class">Widget class</h2><p>All widgets should be derivatived from the <em>Widget</em> class, this base class encapsulates the infrastructure such as UI layout, data communication and event dispatching. You can find the builtin widgets under <em>ui-widget/widgets-jsx/</em>, and put your code there, so that we can processes it by unified building scripts.</p><p>For example, we create a sample widget as follows:</p><div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="im">export</span> <span class="im">default</span> <span class="kw">class</span> TextWidget <span class="kw">extends</span> Widget <span class="op">{</span>
    <span class="co">// All widget must overwrite this method</span>
    <span class="at">render</span>() <span class="op">{</span>
        <span class="kw">var</span> text <span class="op">=</span> <span class="kw">this</span>.<span class="at">get_data</span>().<span class="at">map</span>((t<span class="op">,</span> i) <span class="op">=&gt;</span> <span class="op">&lt;</span>div<span class="op">&gt;{</span><span class="va">t</span>.<span class="at">text</span><span class="op">}&lt;</span><span class="ss">/div&gt;</span><span class="sc">)</span><span class="ss">;</span>
<span class="ss">        return super.render</span><span class="sc">(</span>
<span class="ss">            &lt;div&gt;{text}&lt;/div</span><span class="op">&gt;</span>
        )<span class="op">;</span>
    <span class="op">}</span>
<span class="op">}</span></code></pre></div><h3 id="methods">Methods</h3><h4 id="get_data">get_data()</h4><p>This method get all the data cached from inports, returns an array of plain objects whose keys are inports' name.</p><p><strong>Note</strong>: The size of the array is a configurable item(<code>data_cache_size</code>) in <em>spec</em>.</p><h4 id="get_height">get_height()</h4><p>This method returns the <code>height</code> of the instance in <strong>px</strong>.</p><h4 id="get_width">get_width()</h4><p>This method returns the <code>width</code> of the instance in <strong>px</strong>.</p><h4 id="set_cssid-css">set_css(id, css)</h4><p>This method inserts a <em>style</em> element into current HTML document</p><div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;style</span><span class="ot"> id=</span><span class="st">&quot;id&quot;</span><span class="kw">&gt;</span>
  css
<span class="kw">&lt;/style&gt;</span></code></pre></div><h4 id="send_dataout">send_data(out)</h4><p>This method sends the <code>out</code> into the outports, <code>out</code> is the key-value mapping of the outports, e.g. {<code>o1</code>: val1, <code>o2</code>: val2;},</p><p><strong>Note</strong>: the <code>o1</code>, <code>o2</code> is the name of outports</p><h4 id="switch_uiid">switch_ui(id)</h4><p>This method is used to switchs the UIs of the App.</p><h4 id="on_settings_changedprev-next">_on_settings_changed(prev, next)</h4><p>This is a callback function, implement it if you want to handle the event of <code>settings changed</code> which emited by property panel (inspector).</p><h2 id="spec">spec</h2><p><em>spec</em> is a textual description for <strong>Widget</strong>, such as how many <code>inports</code>, <code>outports</code> and <code>configurations</code>, and details.</p><p>Every widget should be described in <code>ui-widgets/specs.js</code>.</p><p>For example, following is the builtin spec of <em>Text</em> widget:</p><div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="op">{</span>
  <span class="dt">id</span><span class="op">:</span>           <span class="st">&quot;hope/ui/text&quot;</span><span class="op">,</span>
  <span class="dt">catalog</span><span class="op">:</span>      <span class="st">&quot;basic&quot;</span><span class="op">,</span>
  <span class="dt">name</span><span class="op">:</span>         <span class="st">&quot;Text&quot;</span><span class="op">,</span>
  <span class="dt">description</span><span class="op">:</span>  <span class="st">&quot;Show Text&quot;</span><span class="op">,</span>
  <span class="dt">icon</span><span class="op">:</span>         <span class="st">&quot;text-width&quot;</span><span class="op">,</span>
  <span class="dt">use_ract</span><span class="op">:</span>     <span class="kw">true</span><span class="op">,</span>
  <span class="dt">data_cache_size</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span>       <span class="co">// how many data items would be cached to show the widget    </span>
                            <span class="co">// 0 for using default, -1 means unliminted</span>
  <span class="dt">config</span><span class="op">:</span> [<span class="op">{</span>
    <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;align&quot;</span><span class="op">,</span>
    <span class="dt">type</span><span class="op">:</span> <span class="st">&quot;option&quot;</span><span class="op">,</span>
    <span class="dt">default</span><span class="op">:</span> <span class="st">&quot;left&quot;</span><span class="op">,</span>
    <span class="dt">options</span><span class="op">:</span> [<span class="st">&quot;left&quot;</span><span class="op">,</span> <span class="st">&quot;center&quot;</span><span class="op">,</span> <span class="st">&quot;right&quot;</span>]
  <span class="op">},</span> <span class="op">{</span>
    <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;font_size&quot;</span><span class="op">,</span>
    <span class="dt">display</span><span class="op">:</span> <span class="st">&quot;Font Size&quot;</span><span class="op">,</span>   <span class="co">// displaying label in property panel</span>
    <span class="dt">type</span><span class="op">:</span> <span class="st">&quot;string&quot;</span>
  <span class="op">}</span>]<span class="op">,</span>
  <span class="kw">in</span><span class="op">:</span> <span class="op">{</span>
    <span class="dt">ports</span><span class="op">:</span> [<span class="op">{</span>
      <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;text&quot;</span><span class="op">,</span>
      <span class="dt">type</span><span class="op">:</span> <span class="st">&quot;string&quot;</span>
    <span class="op">}</span>]
  <span class="op">},</span>
  <span class="dt">out</span><span class="op">:</span> <span class="op">{</span>
    <span class="dt">ports</span><span class="op">:</span> []
  <span class="op">}</span>
<span class="op">}</span></code></pre></div><h3 id="configurations">Configurations</h3><p>For a widget, all property of configuration is divided into two parts, the <strong>config</strong> group always is visible, and the <strong>extra</strong> group is hidden by default.</p><p>Supported data types of configuration item:</p><h4 id="boolean">boolean</h4><p><code>Boolean</code> property, corresponding to a <code>switch</code> button in the property panel.</p><h4 id="number">number</h4><p><code>Number</code> property, corresponding to an <code>editbox</code> in the property panel.</p><h4 id="int">int</h4><p><code>Integer</code> property, corresponding to an <code>editbox</code> in the property panel.</p><h4 id="string">string</h4><p><code>String</code> property, corresponding to an <code>editbox</code> in the property panel.</p><h4 id="option">option</h4><p><code>Option</code> property, corresponding to a <code>combox</code> in the property panel. Options are provided by <code>options</code> property, following three cases are supported:</p><ul><li><code>array</code> of keys, such as the <code>align</code> in spec of <code>hope/ui/text</code> widget.</li><li><p><code>array</code> of plain object, e.g.</p><div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="op">{</span>
  <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;editor_type&quot;</span><span class="op">,</span>
  <span class="dt">type</span><span class="op">:</span> <span class="st">&quot;option&quot;</span><span class="op">,</span>
  <span class="dt">options</span><span class="op">:</span> [<span class="op">{</span>
<span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Single Line&quot;</span><span class="op">,</span>
<span class="dt">value</span><span class="op">:</span> <span class="st">&quot;sle&quot;</span>
  <span class="op">},</span> <span class="op">{</span>
<span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Multiple Line&quot;</span><span class="op">,</span>
<span class="dt">value</span><span class="op">:</span> <span class="st">&quot;mle&quot;</span>
  <span class="op">}</span>]
<span class="op">}</span></code></pre></div></li><li><p><code>string</code>: only <code>__HOPE_APP_UI_LIST__</code> supported now, which will be replaced by a list of UIs in the App.</p></li></ul><h4 id="glyphicon">glyphicon</h4><p>A font icon, developers can easily pick one in the property panel, system now provides up to 576 icons.</p><h4 id="color">color</h4><p>'Color' property, corresponding to an circle <code>button</code> in the property panel, click the button will open a color dialog.</p><h2 id="code-integration">Code integration</h2><p>For a new widget, besides adding its <code>spec</code> in <code>ui-widgets/specs.js</code>, we also need to export it from <code>ui-widgets/index.js</code>.</p><p>Specifically, we should add one key-value pair in <code>widgets</code> object of <code>index.js</code>, and use the unique <code>id</code> of widget as key, and use the constructor of widget as value.</p><p>For example, the <code>text</code> widget is exported as following:</p><div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">exports</span>.<span class="at">widgets</span> <span class="op">=</span> <span class="op">{</span>
  <span class="st">&quot;hope/ui/text&quot;</span><span class="op">:</span> <span class="at">require</span>(<span class="st">&quot;./generated/text&quot;</span>)<span class="op">;</span>
  ...
<span class="op">}</span></code></pre></div>
